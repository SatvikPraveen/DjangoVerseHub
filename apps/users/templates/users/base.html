<!-- File: DjangoVerseHub/templates/base.html -->

{% load static %}
<!DOCTYPE html>
<html
  lang="en"
  data-bs-theme="{% if user.is_authenticated and user.profile.theme == 'dark' %}dark{% else %}light{% endif %}"
>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="DjangoVerseHub - Your gateway to the Django universe"
    />
    <meta name="author" content="DjangoVerseHub Team" />

    <title>
      {% block title %}DjangoVerseHub - Django Community Platform{% endblock %}
    </title>

    <!-- Favicon -->
    <link
      rel="icon"
      type="image/x-icon"
      href="{% static 'images/favicon.ico' %}"
    />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Bootstrap Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <!-- Custom CSS -->
    <link href="{% static 'css/main.css' %}" rel="stylesheet" />

    <!-- Extra CSS -->
    {% block extra_css %}{% endblock %}

    <!-- Meta Tags -->
    <meta
      property="og:title"
      content="{% block og_title %}DjangoVerseHub{% endblock %}"
    />
    <meta
      property="og:description"
      content="{% block og_description %}Your gateway to the Django universe{% endblock %}"
    />
    <meta property="og:image" content="{% static 'images/og-image.jpg' %}" />
    <meta property="og:type" content="website" />

    <!-- Theme Color -->
    <meta name="theme-color" content="#0d6efd" />
  </head>

  <body class="d-flex flex-column min-vh-100">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
      <div class="container">
        <!-- Brand -->
        <a class="navbar-brand fw-bold" href="{% url 'home' %}">
          <i class="bi bi-code-square me-2"></i>
          DjangoVerseHub
        </a>

        <!-- Mobile Toggle -->
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Navigation Links -->
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            <li class="nav-item">
              <a class="nav-link" href="{% url 'home' %}">
                <i class="bi bi-house me-1"></i>Home
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'articles:list' %}">
                <i class="bi bi-newspaper me-1"></i>Articles
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'users:list' %}">
                <i class="bi bi-people me-1"></i>Community
              </a>
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
              >
                <i class="bi bi-grid me-1"></i>More
              </a>
              <ul class="dropdown-menu">
                <li>
                  <a class="dropdown-item" href="#"
                    ><i class="bi bi-question-circle me-2"></i>Help</a
                  >
                </li>
                <li>
                  <a class="dropdown-item" href="#"
                    ><i class="bi bi-info-circle me-2"></i>About</a
                  >
                </li>
                <li>
                  <a class="dropdown-item" href="#"
                    ><i class="bi bi-envelope me-2"></i>Contact</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item" href="#"
                    ><i class="bi bi-github me-2"></i>GitHub</a
                  >
                </li>
              </ul>
            </li>
          </ul>

          <!-- Search Form -->
          <form class="d-flex me-3" role="search">
            <div class="input-group">
              <input
                class="form-control"
                type="search"
                placeholder="Search..."
                aria-label="Search"
              />
              <button class="btn btn-outline-light" type="submit">
                <i class="bi bi-search"></i>
              </button>
            </div>
          </form>

          <!-- User Menu -->
          <ul class="navbar-nav">
            {% if user.is_authenticated %}
            <!-- Notifications -->
            <li class="nav-item dropdown">
              <a
                class="nav-link position-relative"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
              >
                <i class="bi bi-bell"></i>
                <span
                  class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                  style="font-size: 0.6em"
                >
                  3
                </span>
              </a>
              <ul class="dropdown-menu dropdown-menu-end notification-dropdown">
                <li class="dropdown-header">Notifications</li>
                <li>
                  <a class="dropdown-item" href="#">
                    <div class="d-flex">
                      <div class="flex-shrink-0">
                        <i class="bi bi-heart text-danger"></i>
                      </div>
                      <div class="flex-grow-1 ms-2">
                        <small class="text-muted"
                          >Someone liked your article</small
                        >
                      </div>
                    </div>
                  </a>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item text-center small" href="#"
                    >View all notifications</a
                  >
                </li>
              </ul>
            </li>

            <!-- User Dropdown -->
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle d-flex align-items-center"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
              >
                <img
                  src="{{ user.profile.avatar_url }}"
                  alt="Avatar"
                  class="rounded-circle me-2"
                  width="32"
                  height="32"
                />
                <span>{{ user.profile.display_name|truncatechars:15 }}</span>
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li class="dropdown-header">
                  <div class="text-center">
                    <img
                      src="{{ user.profile.avatar_url }}"
                      alt="Avatar"
                      class="rounded-circle mb-2"
                      width="50"
                      height="50"
                    />
                    <div class="fw-bold">{{ user.profile.display_name }}</div>
                    <small class="text-muted">@{{ user.username }}</small>
                  </div>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a
                    class="dropdown-item"
                    href="{% url 'users:profile' pk=user.pk %}"
                  >
                    <i class="bi bi-person me-2"></i>My Profile
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" href="{% url 'users:settings' %}">
                    <i class="bi bi-gear me-2"></i>Settings
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" href="#">
                    <i class="bi bi-file-earmark-text me-2"></i>My Articles
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" href="#">
                    <i class="bi bi-bookmark me-2"></i>Bookmarks
                  </a>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item" href="#">
                    <i class="bi bi-moon me-2"></i>
                    <span id="theme-toggle">
                      {% if user.profile.theme == 'dark' %}Light Mode{% else
                      %}Dark Mode{% endif %}
                    </span>
                  </a>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a
                    class="dropdown-item text-danger"
                    href="{% url 'users:logout' %}"
                  >
                    <i class="bi bi-box-arrow-right me-2"></i>Sign Out
                  </a>
                </li>
              </ul>
            </li>
            {% else %}
            <!-- Guest Menu -->
            <li class="nav-item">
              <a class="nav-link" href="{% url 'users:login' %}">
                <i class="bi bi-box-arrow-in-right me-1"></i>Sign In
              </a>
            </li>
            <li class="nav-item">
              <a
                class="btn btn-outline-light btn-sm ms-2"
                href="{% url 'users:signup' %}"
              >
                <i class="bi bi-person-plus me-1"></i>Sign Up
              </a>
            </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>

    <!-- Breadcrumbs -->
    {% block breadcrumbs %}{% endblock %}

    <!-- Main Content -->
    <main class="flex-grow-1">
      <!-- Messages -->
      {% if messages %}
      <div class="container mt-3">
        {% for message in messages %}
        <div
          class="alert alert-{{ message.tags }} alert-dismissible fade show"
          role="alert"
        >
          {% if message.tags == 'error' %}
          <i class="bi bi-exclamation-triangle me-2"></i>
          {% elif message.tags == 'success' %}
          <i class="bi bi-check-circle me-2"></i>
          {% elif message.tags == 'info' %}
          <i class="bi bi-info-circle me-2"></i>
          {% elif message.tags == 'warning' %}
          <i class="bi bi-exclamation-circle me-2"></i>
          {% endif %} {{ message }}
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="alert"
          ></button>
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <!-- Page Content -->
      {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-light py-5 mt-5">
      <div class="container">
        <div class="row">
          <div class="col-lg-4 mb-4">
            <h5 class="fw-bold mb-3">
              <i class="bi bi-code-square me-2"></i>
              DjangoVerseHub
            </h5>
            <p class="text-light-emphasis">
              Your gateway to the Django universe. Connect, learn, and share
              with the global Django community.
            </p>
            <div class="d-flex gap-3">
              <a href="#" class="text-light">
                <i class="bi bi-twitter fs-5"></i>
              </a>
              <a href="#" class="text-light">
                <i class="bi bi-github fs-5"></i>
              </a>
              <a href="#" class="text-light">
                <i class="bi bi-linkedin fs-5"></i>
              </a>
              <a href="#" class="text-light">
                <i class="bi bi-discord fs-5"></i>
              </a>
            </div>
          </div>

          <div class="col-lg-2 col-md-3 mb-4">
            <h6 class="fw-bold mb-3">Community</h6>
            <ul class="list-unstyled">
              <li class="mb-2">
                <a
                  href="{% url 'articles:list' %}"
                  class="text-light-emphasis text-decoration-none"
                  >Articles</a
                >
              </li>
              <li class="mb-2">
                <a
                  href="{% url 'users:list' %}"
                  class="text-light-emphasis text-decoration-none"
                  >Members</a
                >
              </li>
              <li class="mb-2">
                <a href="#" class="text-light-emphasis text-decoration-none"
                  >Discussion</a
                >
              </li>
              <li class="mb-2">
                <a href="#" class="text-light-emphasis text-decoration-none"
                  >Events</a
                >
              </li>
            </ul>
          </div>

          <div class="col-lg-2 col-md-3 mb-4">
            <h6 class="fw-bold mb-3">Resources</h6>
            <ul class="list-unstyled">
              <li class="mb-2">
                <a href="#" class="text-light-emphasis text-decoration-none"
                  >Documentation</a
                >
              </li>
              <li class="mb-2">
                <a href="#" class="text-light-emphasis text-decoration-none"
                  >Tutorials</a
                >
              </li>
              <li class="mb-2">
                <a href="#" class="text-light-emphasis text-decoration-none"
                  >API Reference</a
                >
              </li>
              <li class="mb-2">
                <a href="#" class="text-light-emphasis text-decoration-none"
                  >Best Practices</a
                >
              </li>
            </ul>
          </div>

          <div class="col-lg-2 col-md-3 mb-4">
            <h6 class="fw-bold mb-3">Support</h6>
            <ul class="list-unstyled">
              <li class="mb-2">
                <a href="#" class="text-light-emphasis text-decoration-none"
                  >Help Center</a
                >
              </li>
              <li class="mb-2">
                <a href="#" class="text-light-emphasis text-decoration-none"
                  >Contact Us</a
                >
              </li>
              <li class="mb-2">
                <a href="#" class="text-light-emphasis text-decoration-none"
                  >Report Bug</a
                >
              </li>
              <li class="mb-2">
                <a href="#" class="text-light-emphasis text-decoration-none"
                  >Feature Request</a
                >
              </li>
            </ul>
          </div>

          <div class="col-lg-2 col-md-3 mb-4">
            <h6 class="fw-bold mb-3">Legal</h6>
            <ul class="list-unstyled">
              <li class="mb-2">
                <a href="#" class="text-light-emphasis text-decoration-none"
                  >Privacy Policy</a
                >
              </li>
              <li class="mb-2">
                <a href="#" class="text-light-emphasis text-decoration-none"
                  >Terms of Service</a
                >
              </li>
              <li class="mb-2">
                <a href="#" class="text-light-emphasis text-decoration-none"
                  >Cookie Policy</a
                >
              </li>
              <li class="mb-2">
                <a href="#" class="text-light-emphasis text-decoration-none"
                  >Guidelines</a
                >
              </li>
            </ul>
          </div>
        </div>

        <hr class="my-4 text-light-emphasis" />

        <div class="row align-items-center">
          <div class="col-md-6">
            <p class="mb-0 text-light-emphasis">
              &copy; {% now "Y" %} DjangoVerseHub. All rights reserved.
            </p>
          </div>
          <div class="col-md-6 text-md-end">
            <p class="mb-0 text-light-emphasis">
              Made with <i class="bi bi-heart-fill text-danger"></i> by the
              Django community
            </p>
          </div>
        </div>
      </div>
    </footer>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
      <!-- Toasts will be inserted here dynamically -->
    </div>

    <!-- Loading Spinner -->
    <div id="loading-spinner" class="d-none">
      <div class="spinner-overlay">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
    </div>

    <!-- JavaScript Libraries -->
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- jQuery (if needed) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- Custom JavaScript -->
    <script src="{% static 'js/main.js' %}"></script>

    <!-- Page-specific JavaScript -->
    {% block extra_js %}{% endblock %}

    <!-- Global JavaScript Functions -->
    <script>
      // Theme toggle functionality
      document.addEventListener('DOMContentLoaded', function() {
          const themeToggle = document.getElementById('theme-toggle');
          if (themeToggle) {
              themeToggle.closest('a').addEventListener('click', function(e) {
                  e.preventDefault();
                  toggleTheme();
              });
          }
      });

      function toggleTheme() {
          const currentTheme = document.documentElement.getAttribute('data-bs-theme');
          const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

          document.documentElement.setAttribute('data-bs-theme', newTheme);

          // Update theme toggle text
          const themeToggle = document.getElementById('theme-toggle');
          if (themeToggle) {
              themeToggle.textContent = newTheme === 'dark' ? 'Light Mode' : 'Dark Mode';
          }

          // Save theme preference (if user is authenticated)
          {% if user.is_authenticated %}
          fetch('/api/users/profiles/me/', {
              method: 'PATCH',
              headers: {
                  'Content-Type': 'application/json',
                  'X-CSRFToken': getCookie('csrftoken')
              },
              body: JSON.stringify({ theme: newTheme })
          });
          {% endif %}
      }

      // Utility function to get CSRF token
      function getCookie(name) {
          let cookieValue = null;
          if (document.cookie && document.cookie !== '') {
              const cookies = document.cookie.split(';');
              for (let i = 0; i < cookies.length; i++) {
                  const cookie = cookies[i].trim();
                  if (cookie.substring(0, name.length + 1) === (name + '=')) {
                      cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                      break;
                  }
              }
          }
          return cookieValue;
      }

      // Show loading spinner
      function showLoading() {
          document.getElementById('loading-spinner').classList.remove('d-none');
      }

      // Hide loading spinner
      function hideLoading() {
          document.getElementById('loading-spinner').classList.add('d-none');
      }

      // Show toast notification
      function showToast(message, type = 'info') {
          const toastContainer = document.querySelector('.toast-container');
          const toastId = 'toast-' + Date.now();

          const toastHTML = `
              <div id="${toastId}" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                  <div class="toast-header">
                      <i class="bi bi-info-circle me-2 text-${type}"></i>
                      <strong class="me-auto">Notification</strong>
                      <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                  </div>
                  <div class="toast-body">
                      ${message}
                  </div>
              </div>
          `;

          toastContainer.insertAdjacentHTML('beforeend', toastHTML);

          const toast = new bootstrap.Toast(document.getElementById(toastId));
          toast.show();

          // Remove toast element after it's hidden
          document.getElementById(toastId).addEventListener('hidden.bs.toast', function() {
              this.remove();
          });
      }

      // Auto-dismiss alerts after 5 seconds
      document.addEventListener('DOMContentLoaded', function() {
          const alerts = document.querySelectorAll('.alert:not(.alert-permanent)');
          alerts.forEach(function(alert) {
              setTimeout(function() {
                  const bsAlert = new bootstrap.Alert(alert);
                  bsAlert.close();
              }, 5000);
          });
      });

      // Search functionality
      document.addEventListener('DOMContentLoaded', function() {
          const searchForm = document.querySelector('form[role="search"]');
          if (searchForm) {
              searchForm.addEventListener('submit', function(e) {
                  e.preventDefault();
                  const query = this.querySelector('input').value.trim();
                  if (query) {
                      window.location.href = `/search/?q=${encodeURIComponent(query)}`;
                  }
              });
          }
      });
    </script>
  </body>
</html>
