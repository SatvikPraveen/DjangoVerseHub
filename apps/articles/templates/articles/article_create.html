<!-- File: DjangoVerseHub/apps/articles/templates/articles/article_create.html -->
{% extends 'base.html' %} {% load static %} {% block title %}Create Article -
DjangoVerseHub{% endblock %} {% block content %}
<div class="container">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <h1>Create New Article</h1>

      <form
        method="post"
        enctype="multipart/form-data"
        class="needs-validation"
        novalidate
      >
        {% csrf_token %}

        <div class="mb-3">
          <label for="{{ form.title.id_for_label }}" class="form-label"
            >Title *</label
          >
          {{ form.title }} {% if form.title.errors %}
          <div class="invalid-feedback d-block">{{ form.title.errors }}</div>
          {% endif %}
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="{{ form.category.id_for_label }}" class="form-label"
              >Category</label
            >
            {{ form.category }}
          </div>

          <div class="col-md-6 mb-3">
            <label for="{{ form.status.id_for_label }}" class="form-label"
              >Status</label
            >
            {{ form.status }}
          </div>
        </div>

        <div class="mb-3">
          <label for="{{ form.summary.id_for_label }}" class="form-label"
            >Summary</label
          >
          {{ form.summary }}
          <div class="form-text">
            Brief description of your article (optional)
          </div>
        </div>

        <div class="mb-3">
          <label for="{{ form.content.id_for_label }}" class="form-label"
            >Content *</label
          >
          {{ form.content }} {% if form.content.errors %}
          <div class="invalid-feedback d-block">{{ form.content.errors }}</div>
          {% endif %}
        </div>

        <div class="mb-3">
          <label for="{{ form.featured_image.id_for_label }}" class="form-label"
            >Featured Image</label
          >
          {{ form.featured_image }}
          <div class="form-text">
            Upload an image for your article (max 5MB)
          </div>
          {% if form.featured_image.errors %}
          <div class="invalid-feedback d-block">
            {{ form.featured_image.errors }}
          </div>
          {% endif %}
        </div>

        <div class="mb-3">
          <label class="form-label">Tags</label>
          <div class="tags-container">
            {% for tag in form.tags %}
            <div class="form-check form-check-inline">
              {{ tag.tag }}
              <label class="form-check-label" for="{{ tag.id_for_label }}">
                {{ tag.choice_label }}
              </label>
            </div>
            {% endfor %}
          </div>
        </div>

        <div class="mb-3">
          <div class="form-check">
            {{ form.allow_comments }}
            <label
              class="form-check-label"
              for="{{ form.allow_comments.id_for_label }}"
            >
              Allow Comments
            </label>
          </div>
        </div>

        {% if user.is_staff %}
        <div class="mb-3">
          <div class="form-check">
            {{ form.is_featured }}
            <label
              class="form-check-label"
              for="{{ form.is_featured.id_for_label }}"
            >
              Featured Article
            </label>
          </div>
        </div>
        {% endif %}

        <!-- SEO Section -->
        <div class="card mb-4">
          <div class="card-header">
            <h5>SEO Settings (Optional)</h5>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <label
                for="{{ form.meta_description.id_for_label }}"
                class="form-label"
                >Meta Description</label
              >
              {{ form.meta_description }}
              <div class="form-text">
                Description for search engines (160 characters max)
              </div>
            </div>

            <div class="mb-3">
              <label
                for="{{ form.meta_keywords.id_for_label }}"
                class="form-label"
                >Meta Keywords</label
              >
              {{ form.meta_keywords }}
              <div class="form-text">Comma-separated keywords for SEO</div>
            </div>
          </div>
        </div>

        <div class="d-flex justify-content-between">
          <a href="{% url 'articles:list' %}" class="btn btn-secondary"
            >Cancel</a
          >
          <div>
            <button
              type="submit"
              name="action"
              value="save"
              class="btn btn-primary"
            >
              Save Article
            </button>
            {% if user.is_authenticated %}
            <button
              type="submit"
              name="action"
              value="publish"
              class="btn btn-success"
            >
              Publish Now
            </button>
            {% endif %}
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  // Form validation
  (function () {
    "use strict";
    window.addEventListener(
      "load",
      function () {
        var forms = document.getElementsByClassName("needs-validation");
        var validation = Array.prototype.filter.call(forms, function (form) {
          form.addEventListener(
            "submit",
            function (event) {
              if (form.checkValidity() === false) {
                event.preventDefault();
                event.stopPropagation();
              }
              form.classList.add("was-validated");
            },
            false
          );
        });
      },
      false
    );
  })();

  // Auto-save draft functionality
  let autoSaveTimer;
  function autoSave() {
    clearTimeout(autoSaveTimer);
    autoSaveTimer = setTimeout(() => {
      const title = document.querySelector('input[name="title"]').value;
      const content = document.querySelector('textarea[name="content"]').value;

      if (title || content) {
        // Save to localStorage as backup
        localStorage.setItem(
          "article_draft",
          JSON.stringify({
            title: title,
            content: content,
            timestamp: new Date().toISOString(),
          })
        );
      }
    }, 2000);
  }

  document
    .querySelector('input[name="title"]')
    .addEventListener("input", autoSave);
  document
    .querySelector('textarea[name="content"]')
    .addEventListener("input", autoSave);

  // Load draft on page load
  window.addEventListener("load", function () {
    const draft = localStorage.getItem("article_draft");
    if (draft) {
      const draftData = JSON.parse(draft);
      const titleField = document.querySelector('input[name="title"]');
      const contentField = document.querySelector('textarea[name="content"]');

      if (!titleField.value && draftData.title) {
        titleField.value = draftData.title;
      }
      if (!contentField.value && draftData.content) {
        contentField.value = draftData.content;
      }
    }
  });
</script>
{% endblock %}
