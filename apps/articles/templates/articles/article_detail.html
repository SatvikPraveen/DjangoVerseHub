<!-- File: DjangoVerseHub/apps/articles/templates/articles/article_detail.html -->
{% extends 'base.html' %} {% load static %} {% block title %}{{ article.title }}
- DjangoVerseHub{% endblock %} {% block meta_description %}{{
article.meta_description|default:article.summary }}{% endblock %} {% block
meta_keywords %}{{ article.meta_keywords }}{% endblock %} {% block content %}
<div class="container">
  <div class="row">
    <div class="col-lg-8">
      <article class="article-detail">
        <header class="article-header mb-4">
          <h1>{{ article.title }}</h1>

          <div class="article-meta mb-3">
            <div class="d-flex align-items-center">
              <img
                src="{{ article.author.profile.get_avatar_url }}"
                class="avatar me-2"
                alt="{{ article.author.get_full_name }}"
              />
              <div>
                <strong>{{ article.author.get_full_name }}</strong><br />
                <small class="text-muted">
                  Published {{ article.published_at|date:"M d, Y" }} ‚Ä¢ {{
                  article.reading_time }} min read ‚Ä¢ {{ article.views_count }}
                  views
                </small>
              </div>
            </div>
          </div>

          {% if article.category or article.tags.exists %}
          <div class="article-tags mb-3">
            {% if article.category %}
            <span class="badge bg-primary me-2"
              >{{ article.category.name }}</span
            >
            {% endif %} {% for tag in article.tags.all %}
            <span class="badge bg-secondary me-1">{{ tag.name }}</span>
            {% endfor %}
          </div>
          {% endif %} {% if article.featured_image %}
          <div class="article-image mb-4">
            <img
              src="{{ article.featured_image.url }}"
              class="img-fluid rounded"
              alt="{{ article.title }}"
            />
          </div>
          {% endif %}
        </header>

        <div class="article-content">
          {% if article.summary %}
          <div class="article-summary alert alert-light">
            <strong>Summary:</strong> {{ article.summary }}
          </div>
          {% endif %}

          <div class="content">{{ article.content|linebreaks }}</div>
        </div>

        <footer class="article-footer mt-5">
          <div class="d-flex justify-content-between align-items-center">
            <div class="article-actions">
              <button
                class="btn btn-outline-primary btn-sm"
                onclick="likeArticle({{ article.id }})"
              >
                üëç Like ({{ article.likes_count }})
              </button>
              <button
                class="btn btn-outline-secondary btn-sm"
                onclick="shareArticle()"
              >
                üì§ Share
              </button>
            </div>

            {% if user.is_authenticated and user == article.author %}
            <div class="author-actions">
              <a
                href="{% url 'articles:edit' slug=article.slug %}"
                class="btn btn-warning btn-sm"
                >Edit</a
              >
              <a
                href="{% url 'articles:delete' slug=article.slug %}"
                class="btn btn-danger btn-sm"
                >Delete</a
              >
            </div>
            {% endif %}
          </div>

          <hr class="my-4" />

          <!-- Author Bio -->
          <div class="author-bio">
            <div class="d-flex">
              <img
                src="{{ article.author.profile.get_avatar_url }}"
                class="avatar-lg me-3"
                alt="{{ article.author.get_full_name }}"
              />
              <div>
                <h5>{{ article.author.get_full_name }}</h5>
                <p>
                  {{ article.author.profile.bio|default:"No bio available." }}
                </p>
                <a
                  href="{% url 'users:profile' pk=article.author.pk %}"
                  class="btn btn-outline-primary btn-sm"
                  >View Profile</a
                >
              </div>
            </div>
          </div>
        </footer>
      </article>

      <!-- Comments Section -->
      {% if article.allow_comments %}
      <section class="comments-section mt-5">
        <h3>Comments ({{ article.comment_count }})</h3>

        {% if user.is_authenticated %}
        <div class="comment-form mb-4">
          <form action="{% url 'comments:create' %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="article" value="{{ article.id }}" />
            <div class="mb-3">
              <textarea
                name="content"
                class="form-control"
                rows="4"
                placeholder="Share your thoughts..."
                required
              ></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Post Comment</button>
          </form>
        </div>
        {% else %}
        <div class="alert alert-info">
          <a href="{% url 'account_login' %}">Login</a> to post a comment.
        </div>
        {% endif %}

        <!-- Comments List -->
        <div class="comments-list">
          {% for comment in comments %}
          <div class="comment">
            <div class="d-flex">
              <img
                src="{{ comment.author.profile.get_avatar_url }}"
                class="avatar me-2"
                alt="{{ comment.author.get_full_name }}"
              />
              <div class="flex-grow-1">
                <strong>{{ comment.author.get_full_name }}</strong>
                <small class="text-muted"
                  >{{ comment.created_at|timesince }} ago</small
                >
                <p class="mt-2">{{ comment.content|linebreaks }}</p>
              </div>
            </div>
          </div>
          {% empty %}
          <p class="text-muted">No comments yet. Be the first to comment!</p>
          {% endfor %}
        </div>
      </section>
      {% endif %}
    </div>

    <!-- Sidebar -->
    <div class="col-lg-4">
      <div class="sidebar">
        <!-- Related Articles -->
        {% if related_articles %}
        <div class="card mb-4">
          <div class="card-header">
            <h5>Related Articles</h5>
          </div>
          <div class="card-body">
            {% for related in related_articles %}
            <div class="d-flex mb-3">
              <img
                src="{{ related.get_featured_image_url }}"
                class="me-2"
                style="width: 60px; height: 60px; object-fit: cover"
                alt="{{ related.title }}"
              />
              <div>
                <a
                  href="{% url 'articles:detail' slug=related.slug %}"
                  class="fw-bold text-decoration-none"
                >
                  {{ related.title|truncatechars:50 }}
                </a>
                <br />
                <small class="text-muted"
                  >{{ related.created_at|date:"M d" }}</small
                >
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- Article Stats -->
        <div class="card">
          <div class="card-header">
            <h5>Article Stats</h5>
          </div>
          <div class="card-body">
            <ul class="list-unstyled">
              <li><strong>Views:</strong> {{ article.views_count }}</li>
              <li><strong>Likes:</strong> {{ article.likes_count }}</li>
              <li><strong>Comments:</strong> {{ article.comment_count }}</li>
              <li><strong>Shares:</strong> {{ article.shares_count }}</li>
              <li>
                <strong>Reading Time:</strong> {{ article.reading_time }} min
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function likeArticle(articleId) {
    // AJAX call to like article
    console.log("Like article:", articleId);
  }

  function shareArticle() {
    if (navigator.share) {
      navigator.share({
        title: "{{ article.title }}",
        text: "{{ article.summary|truncatechars:100 }}",
        url: window.location.href,
      });
    } else {
      // Fallback for browsers that don't support Web Share API
      navigator.clipboard.writeText(window.location.href);
      alert("Link copied to clipboard!");
    }
  }
</script>
{% endblock %}
