<!-- File: DjangoVerseHub/templates/errors/403.html -->

{% load static %}
<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Access Denied (403) - DjangoVerseHub</title>

    <link
      rel="icon"
      type="image/x-icon"
      href="{% static 'images/favicon.ico' %}"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link href="{% static 'css/main.css' %}" rel="stylesheet" />

    <style>
      .error-container {
        min-height: 100vh;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        display: flex;
        align-items: center;
        position: relative;
        overflow: hidden;
      }

      .error-container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3Cpattern id='shield' width='20' height='20' patternUnits='userSpaceOnUse'%3E%3Cpath d='M10 0 L15 5 L10 10 L5 5 Z' fill='none' stroke='rgba(255,255,255,0.1)' stroke-width='1'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='url(%23shield)'/%3E%3C/svg%3E");
        opacity: 0.3;
      }

      .error-content {
        position: relative;
        z-index: 1;
      }

      .error-number {
        font-size: 8rem;
        font-weight: 900;
        color: white;
        text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        line-height: 1;
        margin-bottom: 1rem;
      }

      .shield-icon {
        font-size: 5rem;
        color: rgba(255, 255, 255, 0.9);
        margin-bottom: 2rem;
        animation: shake 0.5s ease-in-out;
        animation-delay: 1s;
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-10px);
        }
        75% {
          transform: translateX(10px);
        }
      }

      .btn-glass {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        color: white;
        transition: all 0.3s ease;
      }

      .btn-glass:hover {
        background: rgba(255, 255, 255, 0.2);
        border-color: rgba(255, 255, 255, 0.3);
        color: white;
        transform: translateY(-2px);
      }

      .permission-card {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        border-radius: 1rem;
        padding: 2rem;
        margin: 2rem 0;
      }

      .floating-shields {
        position: absolute;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      .floating-shield {
        position: absolute;
        opacity: 0.1;
        animation: float-shield 12s infinite linear;
        font-size: 2rem;
      }

      @keyframes float-shield {
        0% {
          transform: translateY(100vh) translateX(0px) rotate(0deg);
          opacity: 0;
        }
        10% {
          opacity: 0.1;
        }
        90% {
          opacity: 0.1;
        }
        100% {
          transform: translateY(-100px) translateX(50px) rotate(180deg);
          opacity: 0;
        }
      }
    </style>
  </head>

  <body>
    <div class="error-container">
      <!-- Floating Background Elements -->
      <div class="floating-shields">
        <div class="floating-shield" style="left: 15%; animation-delay: -2s">
          <i class="bi bi-shield-exclamation"></i>
        </div>
        <div class="floating-shield" style="left: 25%; animation-delay: -4s">
          <i class="bi bi-lock"></i>
        </div>
        <div class="floating-shield" style="left: 35%; animation-delay: -1s">
          <i class="bi bi-key"></i>
        </div>
        <div class="floating-shield" style="left: 65%; animation-delay: -3s">
          <i class="bi bi-shield-slash"></i>
        </div>
        <div class="floating-shield" style="left: 75%; animation-delay: -5s">
          <i class="bi bi-person-x"></i>
        </div>
        <div class="floating-shield" style="left: 85%; animation-delay: -1.5s">
          <i class="bi bi-exclamation-triangle"></i>
        </div>
      </div>

      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-8 col-md-10">
            <div class="text-center error-content">
              <!-- Shield Icon -->
              <div class="shield-icon">
                <i class="bi bi-shield-exclamation"></i>
              </div>

              <!-- Error Number -->
              <div class="error-number">403</div>

              <!-- Error Message -->
              <h1 class="display-6 text-white mb-4">Access Denied</h1>
              <p class="lead text-white-50 mb-4">
                Sorry, you don't have permission to access this resource. This
                area is restricted and requires proper authorization.
              </p>

              <!-- Permission Info Card -->
              <div class="permission-card">
                <div class="row align-items-center">
                  <div class="col-md-2 mb-3 mb-md-0">
                    <i class="bi bi-info-circle fs-1 text-white-50"></i>
                  </div>
                  <div class="col-md-10 text-start">
                    <h5 class="text-white mb-2">Why am I seeing this?</h5>
                    <ul class="text-white-50 mb-0">
                      <li>You may not be logged in</li>
                      <li>
                        Your account may not have the required permissions
                      </li>
                      <li>
                        The resource may be restricted to specific user groups
                      </li>
                      <li>Your session may have expired</li>
                    </ul>
                  </div>
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="row g-3 justify-content-center mb-5">
                {% if not user.is_authenticated %}
                <div class="col-auto">
                  <a
                    href="{% url 'users:login' %}?next={{ request.get_full_path|urlencode }}"
                    class="btn btn-glass btn-lg"
                  >
                    <i class="bi bi-box-arrow-in-right me-2"></i>Sign In
                  </a>
                </div>
                <div class="col-auto">
                  <a
                    href="{% url 'users:signup' %}"
                    class="btn btn-glass btn-lg"
                  >
                    <i class="bi bi-person-plus me-2"></i>Create Account
                  </a>
                </div>
                {% else %}
                <div class="col-auto">
                  <a
                    href="{% url 'users:profile' pk=user.pk %}"
                    class="btn btn-glass btn-lg"
                  >
                    <i class="bi bi-person me-2"></i>My Profile
                  </a>
                </div>
                <div class="col-auto">
                  <button
                    onclick="requestAccess()"
                    class="btn btn-glass btn-lg"
                  >
                    <i class="bi bi-envelope me-2"></i>Request Access
                  </button>
                </div>
                {% endif %}
                <div class="col-auto">
                  <a href="{% url 'home' %}" class="btn btn-glass btn-lg">
                    <i class="bi bi-house me-2"></i>Go Home
                  </a>
                </div>
                <div class="col-auto">
                  <a
                    href="javascript:history.back()"
                    class="btn btn-glass btn-lg"
                  >
                    <i class="bi bi-arrow-left me-2"></i>Go Back
                  </a>
                </div>
              </div>

              <!-- Contact Support -->
              <div class="mt-5 pt-4 border-top border-white-25">
                <h5 class="text-white mb-4">Need Help?</h5>
                <div class="row g-4 justify-content-center">
                  <div class="col-md-6">
                    <div class="text-center">
                      <i
                        class="bi bi-headset fs-3 mb-3 d-block text-white-50"
                      ></i>
                      <h6 class="text-white">Contact Support</h6>
                      <p class="text-white-50 small mb-3">
                        Our support team can help resolve access issues
                      </p>
                      <a href="#" class="btn btn-outline-light btn-sm">
                        <i class="bi bi-envelope me-1"></i>Contact Support
                      </a>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="text-center">
                      <i
                        class="bi bi-question-circle fs-3 mb-3 d-block text-white-50"
                      ></i>
                      <h6 class="text-white">Help Center</h6>
                      <p class="text-white-50 small mb-3">
                        Learn about permissions and account types
                      </p>
                      <a href="#" class="btn btn-outline-light btn-sm">
                        <i class="bi bi-book me-1"></i>Help Center
                      </a>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Access Levels Info -->
              <div class="mt-5">
                <h6 class="text-white mb-3">Access Levels</h6>
                <div class="row g-3 justify-content-center text-white-50 small">
                  <div class="col-lg-3 col-md-6">
                    <div class="text-center">
                      <i class="bi bi-person-circle fs-4 mb-2 d-block"></i>
                      <strong class="text-white d-block">Guest</strong>
                      <span>Read public content</span>
                    </div>
                  </div>
                  <div class="col-lg-3 col-md-6">
                    <div class="text-center">
                      <i class="bi bi-person-check fs-4 mb-2 d-block"></i>
                      <strong class="text-white d-block">Member</strong>
                      <span>Create and comment</span>
                    </div>
                  </div>
                  <div class="col-lg-3 col-md-6">
                    <div class="text-center">
                      <i class="bi bi-star fs-4 mb-2 d-block"></i>
                      <strong class="text-white d-block">Premium</strong>
                      <span>Advanced features</span>
                    </div>
                  </div>
                  <div class="col-lg-3 col-md-6">
                    <div class="text-center">
                      <i class="bi bi-shield-check fs-4 mb-2 d-block"></i>
                      <strong class="text-white d-block">Admin</strong>
                      <span>Full system access</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Error Details -->
              <div class="mt-5 pt-4">
                <details class="text-white-50 small">
                  <summary class="mb-2 cursor-pointer">
                    Technical Details
                  </summary>
                  <div class="text-start">
                    <p><strong>Error Code:</strong> 403 Forbidden</p>
                    <p>
                      <strong>Timestamp:</strong> <span id="error-time"></span>
                    </p>
                    <p>
                      <strong>User:</strong>
                      {% if user.is_authenticated %} {{ user.username }} (ID: {{
                      user.id }}) {% else %} Anonymous {% endif %}
                    </p>
                    <p>
                      <strong>Requested URL:</strong> {{ request.get_full_path
                      }}
                    </p>
                    <p>
                      <strong>Referrer:</strong>
                      <span id="referrer-url">-</span>
                    </p>
                  </div>
                </details>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Display current time and referrer
      document.getElementById('error-time').textContent = new Date().toLocaleString();
      document.getElementById('referrer-url').textContent = document.referrer || 'Direct access';

      // Request access function
      function requestAccess() {
          const requestData = {
              url: window.location.href,
              user: '{{ user.username|default:"anonymous" }}',
              timestamp: new Date().toISOString(),
              reason: prompt('Please briefly describe why you need access to this resource:')
          };

          if (requestData.reason) {
              // Send access request (implement your access request logic)
              console.log('Access request:', requestData);
              alert('Your access request has been submitted. You will be contacted within 24 hours.');
          }
      }

      // Enhanced floating animation for shields
      function createFloatingShield() {
          const icons = ['bi-shield', 'bi-shield-check', 'bi-shield-exclamation', 'bi-shield-slash', 'bi-lock', 'bi-unlock', 'bi-key'];
          const container = document.querySelector('.floating-shields');

          const element = document.createElement('div');
          element.className = 'floating-shield';
          element.innerHTML = `<i class="${icons[Math.floor(Math.random() * icons.length)]}"></i>`;
          element.style.left = Math.random() * 100 + '%';
          element.style.animationDelay = Math.random() * -12 + 's';
          element.style.animationDuration = (Math.random() * 4 + 12) + 's';

          container.appendChild(element);

          // Remove element after animation
          setTimeout(() => {
              element.remove();
          }, 16000);
      }

      // Create new floating elements periodically
      setInterval(createFloatingShield, 4000);

      // Auto-redirect for temporary access restrictions
      {% if auto_redirect_seconds %}
      let countdown = {{ auto_redirect_seconds }};
      const countdownElement = document.createElement('div');
      countdownElement.className = 'mt-4 text-white-50';
      countdownElement.innerHTML = `<i class="bi bi-clock me-1"></i>Redirecting in <span id="countdown">${countdown}</span> seconds...`;
      document.querySelector('.error-content').appendChild(countdownElement);

      const countdownInterval = setInterval(() => {
          countdown--;
          document.getElementById('countdown').textContent = countdown;

          if (countdown <= 0) {
              clearInterval(countdownInterval);
              window.location.href = '{{ redirect_url|default:"/" }}';
          }
      }, 1000);
      {% endif %}

      // Analytics tracking
      if (window.gtag) {
          gtag('event', 'page_view', {
              'page_title': '403 Error',
              'page_location': window.location.href,
              'custom_map': {
                  'custom_parameter_1': 'error_403'
              }
          });
      }

      // Security event logging
      if (window.apiClient) {
          window.apiClient.post('security/log-access-denied/', {
              url: window.location.href,
              user_agent: navigator.userAgent,
              timestamp: new Date().toISOString()
          }).catch(() => {
              // Silent fail for security logging
          });
      }
    </script>
  </body>
</html>
