<!-- File: DjangoVerseHub/templates/includes/cache/user_sidebar.html -->

{% load static cache %} {% cache 300 user_sidebar user.id
user.profile.updated_at %}
<div class="user-sidebar">
  {% if user.is_authenticated %}
  <!-- User Profile Card -->
  <div class="card mb-4">
    <div class="card-body text-center">
      <img
        src="{{ user.profile.avatar_url }}"
        alt="{{ user.username }}"
        class="rounded-circle mb-3"
        width="80"
        height="80"
      />

      <h5 class="card-title mb-2">{{ user.profile.display_name }}</h5>
      <p class="text-muted mb-3">@{{ user.username }}</p>

      {% if user.profile.bio %}
      <p class="card-text small mb-3">
        {{ user.profile.bio|truncatechars:100 }}
      </p>
      {% endif %}

      <!-- User Stats -->
      <div class="row text-center mb-3">
        <div class="col-4">
          <div class="stat-item">
            <h6 class="stat-number text-primary mb-1">
              {{ user_stats.articles_count|default:0 }}
            </h6>
            <small class="text-muted">Articles</small>
          </div>
        </div>
        <div class="col-4">
          <div class="stat-item">
            <h6 class="stat-number text-success mb-1">
              {{ user_stats.comments_count|default:0 }}
            </h6>
            <small class="text-muted">Comments</small>
          </div>
        </div>
        <div class="col-4">
          <div class="stat-item">
            <h6 class="stat-number text-info mb-1">
              {{ user_stats.likes_received|default:0 }}
            </h6>
            <small class="text-muted">Likes</small>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="d-grid gap-2">
        <a
          href="{% url 'users:profile' pk=user.pk %}"
          class="btn btn-outline-primary btn-sm"
        >
          <i class="bi bi-person me-1"></i>View Profile
        </a>
        <a href="{% url 'articles:create' %}" class="btn btn-primary btn-sm">
          <i class="bi bi-plus-circle me-1"></i>Write Article
        </a>
      </div>
    </div>
  </div>

  <!-- Activity Summary -->
  <div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h6 class="mb-0">Recent Activity</h6>
      <small class="text-muted">Last 7 days</small>
    </div>
    <div class="card-body p-3">
      <div class="activity-timeline">
        {% for activity in recent_activities|slice:":5" %}
        <div class="activity-item d-flex align-items-start mb-3">
          <div class="activity-icon me-2">
            {% if activity.type == 'article_created' %}
            <i class="bi bi-file-plus text-primary"></i>
            {% elif activity.type == 'comment_posted' %}
            <i class="bi bi-chat-dots text-success"></i>
            {% elif activity.type == 'article_liked' %}
            <i class="bi bi-heart text-danger"></i>
            {% else %}
            <i class="bi bi-activity text-info"></i>
            {% endif %}
          </div>
          <div class="activity-content flex-grow-1">
            <p class="mb-1 small">{{ activity.description }}</p>
            <small class="text-muted"
              >{{ activity.created_at|timesince }} ago</small
            >
          </div>
        </div>
        {% empty %}
        <div class="text-center text-muted py-3">
          <i class="bi bi-activity fs-1 mb-2 d-block opacity-50"></i>
          <p class="mb-0 small">No recent activity</p>
        </div>
        {% endfor %}
      </div>

      {% if recent_activities|length > 5 %}
      <div class="text-center mt-3">
        <a
          href="{% url 'users:activity' %}"
          class="btn btn-outline-secondary btn-sm"
        >
          View All Activity
        </a>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Quick Links -->
  <div class="card mb-4">
    <div class="card-header">
      <h6 class="mb-0">Quick Links</h6>
    </div>
    <div class="card-body p-0">
      <div class="list-group list-group-flush">
        <a
          href="{% url 'articles:my_articles' %}"
          class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
        >
          <span><i class="bi bi-file-earmark-text me-2"></i>My Articles</span>
          <span class="badge bg-primary rounded-pill"
            >{{ user_stats.articles_count|default:0 }}</span
          >
        </a>
        <a
          href="{% url 'articles:drafts' %}"
          class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
        >
          <span><i class="bi bi-file-earmark-minus me-2"></i>Drafts</span>
          <span class="badge bg-secondary rounded-pill"
            >{{ user_stats.drafts_count|default:0 }}</span
          >
        </a>
        <a
          href="{% url 'articles:bookmarks' %}"
          class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
        >
          <span><i class="bi bi-bookmark me-2"></i>Bookmarks</span>
          <span class="badge bg-info rounded-pill"
            >{{ user_stats.bookmarks_count|default:0 }}</span
          >
        </a>
        <a
          href="{% url 'users:following' %}"
          class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
        >
          <span><i class="bi bi-people me-2"></i>Following</span>
          <span class="badge bg-success rounded-pill"
            >{{ user_stats.following_count|default:0 }}</span
          >
        </a>
      </div>
    </div>
  </div>

  <!-- Achievements/Badges -->
  {% if user_badges %}
  <div class="card mb-4">
    <div class="card-header">
      <h6 class="mb-0">Achievements</h6>
    </div>
    <div class="card-body">
      <div class="d-flex flex-wrap gap-2">
        {% for badge in user_badges|slice:":6" %}
        <span
          class="badge bg-{{ badge.color|default:'primary' }}"
          title="{{ badge.description }}"
        >
          <i class="bi bi-{{ badge.icon|default:'award' }} me-1"></i>
          {{ badge.name }}
        </span>
        {% endfor %} {% if user_badges|length > 6 %}
        <span class="badge bg-secondary"
          >+{{ user_badges|length|add:"-6" }} more</span
        >
        {% endif %}
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Notifications Summary -->
  <div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h6 class="mb-0">Notifications</h6>
      {% if unread_notifications_count > 0 %}
      <span class="badge bg-danger">{{ unread_notifications_count }}</span>
      {% endif %}
    </div>
    <div class="card-body">
      {% if recent_notifications %}
      <div class="notification-list">
        {% for notification in recent_notifications|slice:":3" %}
        <div
          class="notification-item d-flex align-items-start mb-2 {% if not notification.read %}bg-light{% endif %} p-2 rounded"
        >
          <div class="notification-icon me-2">
            <i
              class="bi bi-{{ notification.icon|default:'bell' }} text-{{ notification.color|default:'primary' }}"
            ></i>
          </div>
          <div class="notification-content flex-grow-1">
            <p class="mb-1 small">
              {{ notification.message|truncatechars:60 }}
            </p>
            <small class="text-muted"
              >{{ notification.created_at|timesince }} ago</small
            >
          </div>
        </div>
        {% endfor %}
      </div>

      <div class="text-center mt-3">
        <a
          href="{% url 'notifications:list' %}"
          class="btn btn-outline-primary btn-sm"
        >
          View All Notifications
        </a>
      </div>
      {% else %}
      <div class="text-center text-muted py-3">
        <i class="bi bi-bell fs-1 mb-2 d-block opacity-50"></i>
        <p class="mb-0 small">No notifications</p>
      </div>
      {% endif %}
    </div>
  </div>

  {% else %}
  <!-- Guest User Prompt -->
  <div class="card mb-4">
    <div class="card-body text-center">
      <i class="bi bi-person-circle fs-1 text-muted mb-3"></i>
      <h5 class="card-title">Join DjangoVerseHub</h5>
      <p class="card-text text-muted mb-3">
        Connect with Django developers, share knowledge, and build amazing
        projects together.
      </p>
      <div class="d-grid gap-2">
        <a href="{% url 'users:signup' %}" class="btn btn-primary">
          <i class="bi bi-person-plus me-1"></i>Sign Up
        </a>
        <a href="{% url 'users:login' %}" class="btn btn-outline-primary">
          <i class="bi bi-box-arrow-in-right me-1"></i>Sign In
        </a>
      </div>
    </div>
  </div>

  <!-- Community Stats for Guests -->
  <div class="card mb-4">
    <div class="card-header">
      <h6 class="mb-0">Community Stats</h6>
    </div>
    <div class="card-body">
      <div class="row text-center">
        <div class="col-6 mb-3">
          <h5 class="text-primary mb-1">
            {{ community_stats.total_users|default:0 }}
          </h5>
          <small class="text-muted">Members</small>
        </div>
        <div class="col-6 mb-3">
          <h5 class="text-success mb-1">
            {{ community_stats.total_articles|default:0 }}
          </h5>
          <small class="text-muted">Articles</small>
        </div>
        <div class="col-6">
          <h5 class="text-info mb-1">
            {{ community_stats.total_comments|default:0 }}
          </h5>
          <small class="text-muted">Comments</small>
        </div>
        <div class="col-6">
          <h5 class="text-warning mb-1">
            {{ community_stats.active_today|default:0 }}
          </h5>
          <small class="text-muted">Active Today</small>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Featured Content -->
  <div class="card mb-4">
    <div class="card-header">
      <h6 class="mb-0">Featured</h6>
    </div>
    <div class="card-body p-0">
      <div class="list-group list-group-flush">
        <a href="#" class="list-group-item list-group-item-action">
          <div class="d-flex align-items-start">
            <i class="bi bi-star-fill text-warning me-2 mt-1"></i>
            <div>
              <h6 class="mb-1 small">Django 4.2 LTS Released</h6>
              <p class="mb-1 small text-muted">New features and improvements</p>
            </div>
          </div>
        </a>
        <a href="#" class="list-group-item list-group-item-action">
          <div class="d-flex align-items-start">
            <i class="bi bi-lightning-charge text-warning me-2 mt-1"></i>
            <div>
              <h6 class="mb-1 small">Performance Tips</h6>
              <p class="mb-1 small text-muted">Optimize your Django apps</p>
            </div>
          </div>
        </a>
        <a href="#" class="list-group-item list-group-item-action">
          <div class="d-flex align-items-start">
            <i class="bi bi-shield-check text-success me-2 mt-1"></i>
            <div>
              <h6 class="mb-1 small">Security Best Practices</h6>
              <p class="mb-1 small text-muted">Keep your apps secure</p>
            </div>
          </div>
        </a>
      </div>
    </div>
  </div>
</div>

<style>
  .user-sidebar .card {
    transition: transform 0.2s ease-in-out;
  }

  .user-sidebar .card:hover {
    transform: translateY(-2px);
  }

  .activity-timeline .activity-item:last-child {
    margin-bottom: 0 !important;
  }

  .stat-item .stat-number {
    font-weight: 700;
    font-size: 1.1rem;
  }

  .notification-item:hover {
    background-color: var(--bs-light) !important;
  }

  [data-bs-theme="dark"] .notification-item:hover {
    background-color: var(--bs-gray-800) !important;
  }
</style>
{% endcache %}
